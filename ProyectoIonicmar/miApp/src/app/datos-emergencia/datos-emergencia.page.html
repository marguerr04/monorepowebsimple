<ion-header>
  <ion-toolbar>
      <ion-buttons slot="start">
      <ion-menu-button>
      </ion-menu-button>
    </ion-buttons>
    <ion-breadcrumbs>
      <ion-breadcrumb routerLink="/home">Home</ion-breadcrumb>
      <ion-breadcrumb routerLink="/datos-emergencia">Datos de emergencia</ion-breadcrumb>
    </ion-breadcrumbs>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <app-cabeza-perfil></app-cabeza-perfil>
  <br>
  <div class="content-header">
      <h3>Datos de emergencia</h3>

    <ion-list class="bordered-list">
      <ion-item 
          button 
          detail="true" 
          (click)="toggleAlergia()"
          name="Alergias">
          Alergias
          
          <div *ngIf="mostrarAlergias" class="ion-padding">
            
            <div *ngIf="isLoadingAlergias">
              <p>Cargando alergias...</p>
            </div>
            
            <div *ngIf="errorAlergias && !isLoadingAlergias">
              <p style="color: red;">{{ errorAlergias }}</p>
            </div>
            
            <div *ngIf="!isLoadingAlergias && !errorAlergias">
              
              <div *ngIf="alergias.length > 0">
                <div *ngFor="let alergia of alergias">
                  <p>
                    <strong>{{ alergia.nombre }}</strong>
                    <span *ngIf="alergia.tipo"> - {{ alergia.tipo }}</span>
                    <span *ngIf="alergia.severidad"> ({{ alergia.severidad }})</span>
                  </p>
                </div>
              </div>
              
              <div *ngIf="alergias.length === 0">
                <p>No se registran alergias</p>
              </div>
            </div>
          </div>
      </ion-item>

      <ion-item 
          button 
          detail="true" 
          (click)="toggleCondicion()"
          name="Condiciones">
          Condiciones médicas
          
          <div *ngIf="mostrarCondiciones" class="ion-padding">
            
            <div *ngIf="isLoadingDiagnosticos">
              <p>Cargando condiciones médicas...</p>
            </div>
            
            <div *ngIf="errorDiagnosticos && !isLoadingDiagnosticos">
              <p style="color: red;">{{ errorDiagnosticos }}</p>
            </div>
            
            <div *ngIf="!isLoadingDiagnosticos && !errorDiagnosticos">
              
              <div *ngIf="diagnosticos.length > 0">
                <div *ngFor="let diagnostico of diagnosticos">
                  <p>
                    <strong>{{ diagnostico.nombre }}</strong>
                  </p>
                </div>
              </div>
              
              <div *ngIf="diagnosticos.length === 0">
                <p>No se registran condiciones médicas</p>
              </div>
            </div>
          </div>
      </ion-item>

      <ion-item 
          button 
          detail="true" 
          (click)="toggleSangre()"
          name="TipoSangre">
          Tipo de sangre
          
          <div *ngIf="mostrarSangre" class="ion-padding">
            
            <div *ngIf="isLoadingSangre">
              <p>Cargando tipo de sangre...</p>
            </div>
            
            <div *ngIf="errorSangre && !isLoadingSangre">
              <p style="color: red;">{{ errorSangre }}</p>
            </div>
            
            <div *ngIf="!isLoadingSangre && !errorSangre && tipoSangre">
              <p><strong>Tipo de sangre:</strong> {{ tipoSangre }}</p>
              
              <div *ngIf="getCompatibilidadSangre(tipoSangre).puedeDonar.length > 0">
                <p><strong>Puede donar a:</strong> {{ getCompatibilidadSangre(tipoSangre).puedeDonar.join(', ') }}</p>
              </div>
              
              <div *ngIf="getCompatibilidadSangre(tipoSangre).puedeRecibir.length > 0">
                <p><strong>Puede recibir de:</strong> {{ getCompatibilidadSangre(tipoSangre).puedeRecibir.join(', ') }}</p>
              </div>
            </div>
            
            <div *ngIf="!isLoadingSangre && !errorSangre && !tipoSangre">
              <p>Tipo de sangre no registrado</p>
            </div>
          </div>
      </ion-item>
    </ion-list>

  <div class="botones-fila">
    <ion-button class="home-button" routerLink="/home">
      Home
    </ion-button>
  </div><br>

  </div>  
</ion-content>